% \section{Security Proof of the Construction of Functional Commitment with Witness Selector}
% \label{A:sec-hc-ws}

\begin{proof}[Proof of \cref{th:sec-hc-ws}]
  Correctness is straightforward. Let us now prove semi-honest functional binding of $\hc$, simulatability of $\hc$, and semantic security of $\ws$.
  
  \subparagraph{Semi-Honest Functional Binding:}
  Semi-honest functional binding follows directly from the semantic security of the witness selector, which we prove below.
  Indeed, an adversary $\advA$ against semi-honest functional binding generate a functional decommitment $\hcd$ to some value $\hccirout$  for some circuit $\hccir$, on input $\hcr$ and $\hcc = \hccom(1^\secpar,\hcmsg;\hcr)$, such that $\hcout \neq \hccir(\hcmsg)$ (and $\hcd$ is indeed a valid functional decommitment: $\hcver(\hcc,\hccir,\hccirout,\hcd)=1$.)
  This pair $(\hcout,\hcd)$ can be used to decrypt any ciphertext $\wsct \getsr \wsenc(1^\secpar, (\hcc,\hccir), \wsmsg)$ to $\wsmsg' = \smallset{\wsmsg[I,\hcout_I]}_{I \in [\hcciroutlen]}$, which breaks semantic security of the witness selector, as $\hcout \neq \hccir(\hcmsg)$.
  
  \subparagraph{Simulatability:} We need to prove the computational indistinguishability of the following two distributions:
  \begin{align*}
    \distr_0 &= {\left\{
               (\hcc,\hcd)
               \ : \
               \hcr \getsr \bits^\hcrlen; \ \hcc =
               \hccom(1^\secpar,\hcmsg;\hcr); \ \hcd = \hcopen(\hcc, \hccir, \hcmsg,
               \hcr) 
               \right\}}_{\secpar,\hcmsg,\hccir}\enspace, \\
    \distr_1 &= {\left\{  (\hcc,\hcd)
               \ : \ 
               (\hcc, \hcd) \getsr
               \hcsim(1^\secpar, \hccir, \hccir(\hcmsg))
               \right\}}_{\secpar,\hcmsg,\hccir}\enspace.
  \end{align*}
  For that, let us introduce the hybrid distribution $\hybrid$, where $(\hcc,\hcd)$ is generated as in $\distr_0$ except for $\otflowone_{i,b,j}$ for $i \in [S]$, $b = 1-\hccir[i]$, and $j \in [|\gckey[i,b]|]$ that is generated as follows:
  \[ \otflowone_{i,b,j} = \otsendone(1^\secpar,0;\otrandone_{i,b,j})\enspace.  \]

  As $\otrandone_{i,b,j}$ is never revealed, we have the following claim.
  \begin{claim}
    If $\ot$ is receiver-private, then $\distr_0$ and $\hybrid$ are computationally indistinguishable.
  \end{claim}

  We also remark that in $\hybrid$, the input labels $\smallset{\gckey[i,1-\hccir[i]]}$ are never used: only the input labels $\smallset{\gckey'[i]} = \smallset{\gckey[i,\hccir[i]]}$ are used. The only difference between $\hybrid$ and $\distr_1$ is that in $\hybrid$, $(\gckey',\gccir)$ is generated honestly using $\gcgarble$, while in $\distr_1$, it is simulated by $\gcsim$.
  Thus we have the following claim.

  \begin{claim}
    If $\gc$ is simulatable, then $\hybrid$ and $\distr_1$ are computationally indistinguishable.
  \end{claim}

  \subparagraph{Semantic Security of the Witness Selector:}  We need to prove the computational indistinguishability of the following two distributions:
  \begin{align*}
    \distr_0 &= \bigset{
    ((\hcc,\hccir), (\hcout,\hcd), \hcr, \wsct)
    \ : \
               \begin{array}{l}
                 \hcr \getsr \bits^\hcrlen;
                 \hcc = \hccom(1^\secpar,\hcmsg;\hcr); \\
                 \hccirout = \hccir(\hcmsg); \hcd = \hcopen(\hcc,\hccir,\hccirout,\hcr); \\
                 \wsct \getsr \wsenc(1^\secpar,(\hcc,\hccir),\wsmsg)
               \end{array}
    }_{\secpar,\hccir,\hcmsg,\wsmsg} \enspace, \\
    \distr_1 &= \bigset{
    ((\hcc,\hccir), (\hcout,\hcd), \hcr, \wsct)
    \ : \
               \begin{array}{l}
                 \hcr \getsr \bits^\hcrlen; 
                 \hcc = \hccom(1^\secpar,\hcmsg;\hcr); \\
                 \hccirout = \hccir(\hcmsg); \hcd = \hcopen(\hcc,\hccir,\hcout,\hcr); \\
                 \smallset{\wsmsg'[I,B] = \wsmsg[I, \hccirout_I]}_{I,B} \\
                 \wsct \getsr \wsenc(1^\secpar,(\hcc,\hccir),\wsmsg')
               \end{array}
    }_{\secpar,\hccir,\hcmsg,\wsmsg} \enspace. \\
  \end{align*}

  For that, we consider the following hybrid distributions:
  \begin{description}
  \item[Hybrid $\hybrid_1$:] This hybrid is similar to $\distr_0$, except that the second flows of the OT protocol $\otflowtwo_{i,j}$ (generated by $\wsenc$) are now generated as follows: for $i \in [S]$ and $j \in [|\gckey[1,0]|]$:
    \[ \otflowtwo_{i,j} \getsr \otsendtwo(\otflowone_{i,\hccir[i],j},\otmsg_{i,j,\gckey[i,\hccir[i]]_j},\otmsg_{i,j,\gckey[i,\hccir[i]]_j}) \enspace. \]
    As the first flow $\otflowone_{i,\hccir[i],j}$ is generated as $\otflowone_{i,\hccir[i],j} = \otsendone(1^\secpar,\gckey[i,\hccir[i]]_j; \otrandone_{i,b,j}$, we have the following claim.

    \begin{claim}
      If $\ot$ is sender-private, then $\distr_0$ and $\hybrid_1$ are computationally indistinguishable.
    \end{claim}

    We recall that $\otmsg_{i,j,b} = \smallset{\tgckey_{I,B}[i,j,b]}_{I,B}$.
    We remark that in this hybrid, the input labels $\tgckey_{I,B}[i,j,1-\gckey[i,\hccir[i]]_j]$ are not used. Let us write $\tgckey'_{I,B}[i,j] = \tgckey_{I,B}[i,j,\gckey[i,\hccir[i]]_j]$
  \item[Hybrid $\hybrid_2$:] This hybrid is similar to $\hybrid_1$ except that the garbled circuits $\tgccir_{I,B}$ and its input labels $\tgckey'_{I,B}[i,j]$ are simulated: for every $I \in [\hcciroutlen]$ and $B \in \bits$:
    \[ (\tgckey'_{I,B}, \tgcsimcir_{I,B}) \getsr \tgcsim(1^\secpar,\tilde{y}_{I,B})\enspace, \]
    and $\tgccir_{I,B}$ is replaced by $\tgcsimcir_{I,B}$,
    where:
    \begin{align*}
    \tilde{y}_{I,B} &= \tcir_{I,B}(\smallset{\gckey[i,\hccir[i]]}_{i \in [S]}) \\
      &=
      \begin{cases}
        \wsmsg[I,B] &\text{if } \hcout'_I = B \text{ where } \hcout' = \gceval(\gccir,\smallset{\gckey[i,\hccir[i]]}_{i \in [S]}), \\
        \perp &\text{otherwise.}
      \end{cases}
    \end{align*}
    
    We have the following straightforward claim.
    \begin{claim}
      If $\tgc$ is simulatable, then $\hybrid_1$ and $\hybrid_2$ are computationally indistinguishable.
    \end{claim}

    We recall that by definition of $\gccir$ and by correctness of garbling:
    \[ \gceval(\gccir,\smallset{\gckey[i,\hccir[i]]}_{i \in [S]}) = \cir(\hccir) = \univcirc_\secpar(\hccir,\hcmsg) = \hccir(\hcmsg) = \hcout \enspace. \]
    In other words:
    \[ \tilde{y}_{I,B}       =
      \begin{cases}
        \wsmsg[I,B] &\text{if } \hcout_I = B \\
        \perp &\text{otherwise.}
      \end{cases}
    \]
    This hybrid distribution thus only depends on $\smallset{\wsmsg[I,\hcout_I]}_I$.
  \item[Hybrid $\hybrid_3$:] This hybrid is defined with regards to $\distr_1$ exactly as $\hybrid_1$ is defined with regards to $\distr_0$.

    We have the two following immediate claims.
    \begin{claim}
      If $\tgc$ is simulatable, then $\hybrid_2$ and $\hybrid_3$ are computationally indistinguishable.
    \end{claim}

    \begin{claim}
      If $\ot$ is sender-private, then $\hybrid_3$ and $\distr_1$ are computationally indistinguishable.
    \end{claim}
  \end{description}
\end{proof}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../main"
%%% End:
